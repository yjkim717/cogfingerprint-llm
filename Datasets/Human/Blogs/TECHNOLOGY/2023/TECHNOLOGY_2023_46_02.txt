Year: 2023
Author: WaldoOU812
URL: https://www.reddit.com/r/PowerShell/comments/134wto1/scheduled_ftp_transfer_if_and_only_if_files_are/

I'm wondering if someone could help me with a scheduled FTP transfer script I've been working on. I'm (mostly) a Powershell newb and can't take credit for this, but this is what I have so far (courtesy of Google & ChatGPT). #Map a drive to file share location New-PSDrive -Name "N" -PSProvider "FileSystem" -Root "\\ServerName\Archive\FTP" #Create a folder for the month the report is running New-Item -ItemType Directory -Path "N:\$(Get-Date -Format 'MMMM_yyyy')" Remove-PSDrive -Name "N" # PowerShell >=7.3 $PSNativeCommandArgumentPassing = "Legacy" & "C:\Program Files (x86)\WinSCP\WinSCP.com" ` /log="C:\Installs\ftp.domain.com\WinSCP.log" /ini=nul ` /command ` "open sftp://UserName@ftp.domain.com/ -hostkey=`"`"<hostkey>`"`" -privatekey=`"`"C:\installs\FTP.Domain.com\<PrivateKey>`"`" -passphrase=`"`"PassPhrase`"`"" ` "cd /home/UserName" ` "lcd \\ServerName\archive\FTP" ` "get *" ` "exit" $winscpResult = $LastExitCode if ($winscpResult -eq 0) { Write-Host "Success" } else { Write-Host "Error" } exit $winscpResult What I want to do is to configured a Powershell script that I can throw into Task Scheduler to do the following: \- Open a session to an FTP site \- Check to see if there are any files present \- If there are files present, move them to a file share \- If there aren't any files present, close the script So far, I have the script shown above, which I've verified will copy the files over, but which doesn't check anything. I can change this to move the files; as I understand it, that would just consist of changing this line: "lcd \\\\ServerName\\archive\\FTP" \` to this: "mv \\\\ServerName\\archive\\FTP" \` However, I have no clue how to add the if/then portion. Can anyone help with that last portion?
