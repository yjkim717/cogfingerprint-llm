Year: 2020
Author: tonyboy101
URL: https://www.reddit.com/r/exchangeserver/comments/kmrc4s/451_440_dns_query_failed/

Exchange server suddenly stopped working today. Been troubleshooting for hours and this seemed like the best place to ask. There are 3 mailbox databases on the server and running the **Get-Queue | fl** command gives the output: RunspaceId : fcf39b48-561f-43f2-a902-beab84139a7b DeliveryType : SmtpDeliveryToMailbox NextHopDomain : db03 TlsDomain : NextHopConnector : 9f88852f-075d-444c-993a-0e0baccaf609 Status : Retry MessageCount : 49 LastError : \[{LED=451 4.4.0 DNS query failed. The error was: SMTPSEND.DNS.NonExistentDomain; nonexistent domain db03 -> DnsDomainDoesNotExist: InfoDomainNonexistent};{MSG=};{FQDN=db03};{IP=};{LRT=12/29/2020 5:20:47 PM}\] RetryCount : 0 LastRetryTime : 12/29/2020 5:20:47 PM NextRetryTime : 12/29/2020 5:25:47 PM FirstRetryTime : 12/29/2020 5:20:47 PM DeferredMessageCount : 0 LockedMessageCount : 0 LockedScopes : MessageCountsPerPriority : {0, 41, 8, 0} IncludeInSlaCount : 0 DeferredMessageCountsPerPriority : {0, 41, 8, 0} RiskLevel : Normal OutboundIPPool : 0 NextHopCategory : Internal IncomingRate : 0 OutgoingRate : 0 Velocity : 0 OverrideSource : QueueIdentity : EXCHANGE\\4 PriorityDescriptions : {High, Normal, Low, None} Identity : EXCHANGE\\4 IsValid : True ObjectState : New &#x200B; The external queues are clear and emails are able to be sent from EXCHANGE -> gmail Internal queues are filling up and stuck in retry. External email gets bounced back with the same/similar error. Any help is appreciated &#x200B; EDIT: Apparently AAAA records don't work in an IPv4 environment. The server started sending out IPv6 queries even though the server has IPv6 services disabled. I have no idea why it broke in the first place. To fix this issue, I had to specify the Exchange server only use the DNS server next to it, restart the transport services, and email suddenly started working.
