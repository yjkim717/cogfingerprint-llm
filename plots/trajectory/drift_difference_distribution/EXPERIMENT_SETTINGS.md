# Geometry Path Length Drift Difference Visualization Settings

## Overview

This document describes the settings and methodology for the 3×4 panel visualizations of Geometry Path Length drift differences between Human and LLM authors.

## Visualization Structure

### Panel Layout
- **3 Rows**: Academic / Blogs / News (domains)
- **4 Columns**: DS / G4B / G12B / LMK (LLM models)
- **Total**: 12 cells per figure

### Feature Groups
Three separate visualizations are generated:
1. **TF-IDF Geometry Path Length** (`tfidf_geometry_3x4_panel.png`)
2. **SBERT Geometry Path Length** (`sbert_geometry_3x4_panel.png`)
3. **CE Geometry Path Length** (`ce_geometry_3x4_panel.png`)

## Data Source

### Input Files
- **Human data**: `dataset/process/human/{domain}/trajectory_features_combined.csv`
- **LLM data**: `dataset/process/LLM/{provider}/LV3/{domain}/trajectory_features_combined.csv`

### Data Structure
- **Granularity**: Per-author aggregated trajectory features
- **Features**: Path length from Geometry metrics
  - `tfidf_path_length`: TF-IDF embedding space trajectory path length
  - `sbert_path_length`: SBERT embedding space trajectory path length
  - `ce_path_length`: CE (Cognitive Embedding) space trajectory path length

### Data Generation Pipeline
The `trajectory_features_combined.csv` files are generated by:
1. Computing trajectory features per author per year
2. Aggregating features across years per author
3. Combining:
   - `author_timeseries_stats_merged.csv` (base stats)
   - `ce_trajectory_features.csv` (CE Geometry)
   - `tfidf_trajectory_features.csv` (TF-IDF Geometry)
   - `sbert_trajectory_features.csv` (SBERT Geometry)

## Difference Calculation

### Matching Strategy
For each Human author, find matching LLM authors using:
- **Primary matching**: Same `domain`, `field`, and `author_id`
- **Fallback**: Match by `domain` only (if field/author_id missing)

### Difference Formula
```
difference = Human_path_length - LLM_path_length
```

### Comparison Structure
- Each Human author is compared with **each of the 4 LLM models separately**
- **Total comparisons**: ~1648 per feature
  - 412 Human authors × 4 LLM models = 1648 comparisons
- Each comparison represents one Human-LLM author pair

## Visualization Details

### Each Cell Content
- **X-axis**: Human Drift - LLM Drift (difference values)
- **Y-axis**: Count (frequency of differences)
- **Plot type**: Histogram with KDE (Kernel Density Estimation) curve
- **Reference lines**:
  - Red dashed line at 0 (no difference)
  - Black dashed line at mean difference

### Scale Optimization

#### TF-IDF Geometry
- **Data range**: Typically 0.1-0.3
- **Bins**: 6-20 (adaptive based on range)
- **Padding**: 15% of range + std-based adjustment

#### SBERT Geometry
- **Data range**: Typically 0.1-0.5
- **Bins**: 6-20 (adaptive based on range)
- **Padding**: 15% of range + std-based adjustment

#### CE Geometry
- **Data range**: Typically 100-1000+
- **Bins**: 70-140 (adaptive based on range)
- **Scaling**: IQR-based for large ranges (>500), percentile-based for moderate ranges
- **Padding**: Adaptive based on data characteristics

## Statistical Summary

### Sample Sizes
- **Total comparisons per feature**: 1648
- **Breakdown**: 412 Human authors × 4 LLM models

### Feature Statistics (from `drift_difference_statistics.csv`)

#### TF-IDF Path Length
- Mean difference: -0.0864
- Std difference: 0.1968
- Range (Q25-Q75): 0.2127
- Human win rate: 26.3%

#### SBERT Path Length
- Mean difference: 0.1827
- Std difference: 0.2431
- Range (Q25-Q75): 0.2903
- Human win rate: 80.3%

#### CE Path Length
- Mean difference: 259.06
- Std difference: 654.70
- Range (Q25-Q75): 257.28
- Human win rate: 74.1%

## Scripts

### Generation Scripts
1. **TF-IDF**: `scripts/micro/visualization/visualize_tfidf_geometry_3x4.py`
2. **SBERT**: `scripts/micro/visualization/visualize_sbert_geometry_3x4.py`
3. **CE**: `scripts/micro/visualization/visualize_ce_geometry_3x4.py`

### Usage
```bash
# TF-IDF
python scripts/micro/visualization/visualize_tfidf_geometry_3x4.py \
    --level LV3 \
    --output plots/trajectory/drift_difference_distribution

# SBERT
python scripts/micro/visualization/visualize_sbert_geometry_3x4.py \
    --level LV3 \
    --output plots/trajectory/drift_difference_distribution

# CE
python scripts/micro/visualization/visualize_ce_geometry_3x4.py \
    --level LV3 \
    --output plots/trajectory/drift_difference_distribution
```

## Key Design Decisions

### 1. Feature Selection: Path Length Only
- **Rationale**: Path length shows stronger signal and better discriminative power
  - TF-IDF: 3.7× larger mean difference than mean_distance
  - SBERT: 3.6× larger mean difference than mean_distance
  - CE: 5.5× larger mean difference than mean_distance
- **Interpretation**: Path length captures overall trajectory complexity better than other geometry metrics

### 2. Per-Model Comparison (Not Averaged)
- **Approach**: Compare each Human author with each LLM model separately
- **Result**: 1648 comparisons (412 × 4) per feature
- **Alternative considered**: Average across 4 models (would yield 412 comparisons)
- **Rationale**: Preserves model-specific differences and provides more data points

### 3. Domain-Model Separation
- **Structure**: 3×4 panel (3 domains × 4 models)
- **Rationale**: Allows examination of domain-specific and model-specific patterns
- **Benefit**: Can identify if certain models perform differently in specific domains

### 4. Scale Optimization per Feature Group
- **TF-IDF/SBERT**: Fewer bins (6-20) for small ranges
- **CE**: More bins (70-140) for large ranges
- **Rationale**: Prevents bars from being too thin or too thick, ensures readability

## Output Files

### Generated Visualizations
- `tfidf_geometry_3x4_panel.png`: TF-IDF Geometry Path Length distribution
- `sbert_geometry_3x4_panel.png`: SBERT Geometry Path Length distribution
- `ce_geometry_3x4_panel.png`: CE Geometry Path Length distribution

### Statistics
- `drift_difference_statistics.csv`: Summary statistics for all features

## Interpretation Guide

### Reading the Plots
1. **Positive differences** (right of zero line): Human has larger path length than LLM
2. **Negative differences** (left of zero line): LLM has larger path length than Human
3. **Mean difference line**: Average difference across all comparisons
4. **Distribution shape**: Shows variability in differences

### Key Observations
- **SBERT**: Strong positive bias (Human > LLM), 80.3% win rate
- **CE**: Strong positive bias (Human > LLM), 74.1% win rate
- **TF-IDF**: Negative bias (LLM > Human), 26.3% win rate

### Domain-Model Patterns
- Each cell shows domain-specific and model-specific patterns
- Compare across rows (domains) to see domain effects
- Compare across columns (models) to see model effects

## Reproducibility

### Requirements
- Python 3.x
- Required packages: pandas, numpy, matplotlib, seaborn
- Data files: `trajectory_features_combined.csv` for each domain/model/level

### Data Availability
- Human data: `dataset/process/human/{domain}/trajectory_features_combined.csv`
- LLM data: `dataset/process/LLM/{provider}/LV3/{domain}/trajectory_features_combined.csv`

### Version Information
- Level: LV3 only
- Domains: academic, blogs, news
- Models: DS, G4B, G12B, LMK

